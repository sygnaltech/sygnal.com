(()=>{var s={webflowAuthorize:"https://webflow.com/oauth/authorize?client_id=9434ab646a433437cef0f70dba6a15ea7071c8e88bb9c3b4b834d64eccd8f8e1&response_type=code",addAccountKey:"https://eol14so2nvvpr3e.m.pipedream.net",getAccount:"https://eoulx2y119m77lz.m.pipedream.net",listSites:"https://eo56mvz3ecrucu.m.pipedream.net"},h="/u/app";document.addEventListener("DOMContentLoaded",()=>{let e=s.webflowAuthorize;console.log(e);let t=document.getElementById("install-app");t&&(t.href=e)});document.addEventListener("DOMContentLoaded",()=>{console.log(window.location.pathname),window.location.pathname===h&&(new URLSearchParams(window.location.search).has("code")?E():g())});function d(e){for(;e.firstChild;)e.removeChild(e.firstChild);let t=document.createElement("option");t.value="",t.textContent="( select one )",e.appendChild(t),e.value=""}function f(){return null}function g(){let e=f(),t=document.getElementById("config-key"),a=document.getElementById("config-site"),c=document.getElementById("config-app");d(t),d(a),d(c);let l=document.createElement("option");l.value="counter",l.textContent="Counter",c.appendChild(l),fetch(`${s.getAccount}/?account_id=${e.account_id}`).then(i=>i.json()).then(i=>{console.log(i);let m=document.querySelector("[data-bind='account.name']");m&&(m.textContent=i.name),i.keys.forEach(n=>{let o=document.createElement("option");o.value=n,o.textContent=n,t.appendChild(o)}),t.addEventListener("change",function(){let n=this.value;d(a),fetch(`${s.listSites}/?key=${n}`).then(o=>o.json()).then(o=>{o.forEach(u=>{let r=document.createElement("option");r.value=u._id,r.textContent=u.name,a.appendChild(r)})})});let p=document.getElementById("generate-code");p&&p.addEventListener("click",function(){let n=document.getElementById("code");n&&(n.innerHTML="TEST")})})}function E(){console.group("OAuth redirect.");let e=f(),t=new URLSearchParams(window.location.search),a={account_id:e.account_id,code:t.get("code")};fetch(s.addAccountKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a,null,2)}).then(c=>{if(!c.ok)throw new Error("Network response was not ok");window.location.replace(h)}).catch(c=>{alert("Unable to complete setup, please message web@sygnal.com"),console.error("There was a problem with the fetch operation:",c.message)}),console.groupEnd()}})();
//# sourceMappingURL=oauth.js.map
